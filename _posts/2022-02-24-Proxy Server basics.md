---
title: 爬虫基础系列(五)-代理的基本原理
categories:
- Notebook/web crawler
tags: 
---

> 网络爬虫技术相关笔记。网站经常会采取一些反爬虫措施，代理是其中一种反反爬虫的手段。





网站经常会采取一些反爬虫措施，比如服务器会检测某个IP在单位时间内的请求次数，如果超过了某个阔值，就会直接拒绝服务，返回一些错误信息。这种情况可以称为封IP。

既然服务器检测的是某个IP单位时间的请求次数，那么借助某种方式来伪装IP，让服务器识别不出是由我们本机发起的请求，不就可以成功防止封IP了吗？一种有效的方式就是使用代理。

代理实际上指的是代理服务器，英文叫作proxy server，它的功能是代理网络用户去取得网络信息。形象地说，它是网络信息的中转站。在我们正常请求一个网站时，是发送了请求给Web服务器，Web服务器把响应传回给我们。如果设置了代理服务器，实际上就是在本机和服务器之间搭建了一个桥，此时本机不是直接向Web服务器发起请求，而是向代理服务器发出请求，请求会发送给代理服务器，然后由代理服务器再发送给Web服务器，接着由代理服务器再把Web服务器返回的响应转发给本机。这样我们同样可以正常访问网页，但这个过程中Web服务器识别出的真实IP就不再是我们本机的IP了，就成功实现了IP伪装。

代理的作用可归纳为以下几点：

- 突破自身IP访问限制，访问一些平时不能访问的站点；
- 访问一些单位或团体内部资源：比如使用教育网内地址段免费代理服务器，就可以用于对教育网开放的各类FTP下载上传，以及各类资料查询共享等服务；
- 提高访问速度：通常代理服务器都设置一个较大的硬盘缓冲区，当有外界的信息通过时，同时也将其保存到缓冲区中，当其他用户再访问相同的信息时，则直接由缓冲区中取出信息，传给用户，以提高访问速度；
- 隐藏真实IP：上网者也可以通过这种方法隐藏自己的IP，免受攻击。对于爬虫来说，我们用代理就是为了隐藏自身IP，防止自身的IP被封锁。

代理可以根据协议区分，也可以根据其匿名程度区分。

根据代理的协议，可以分为如下类别：

- FTP代理服务器：主要用于访问FTP服务器，一般有上传、下载以及缓存功能，端口一般为21、2121等；
- HTTP代理服务器：主要用于访问网页，一般有内容过滤和缓存功能，端口一般为80、8080、3128等；
- SSL/TLS代理：主要用于访问加密网站，一般有SSL或TLS加密功能(最高支持128位加密强度)，端口一般为443；
- RTSP代理：主要用于访问Real流媒体服务器，一般有缓存功能，端口一般为554；
- Telnet代理：主要用于telnet远程控制(黑客入侵计算机时常用于隐藏身份)，端口一般为23；
- POP3/SMTP代理：主要用于POP3/SMTP方式收发邮件，一般有缓存功能，端口一般为110/25；
- SOCKS代理：只是单纯传递数据包，不关心具体协议和用法，所以速度快很多，一般有缓存功能，端口一般为1080。SOCKS代理协议又分为SOCKS4和SOCKS5，前者只支持TCP，而后者支持TCP和UDP，还支持各种身份验证机制、服务器端域名解析等。简单来说，SOCKS4能做到的SOCKS5都可以做到，但SOCKS5能做到的SOCKS4不一定能做到。

根据代理的匿名程度，可分为如下类别：

- 高度匿名代理：会将数据包原封不动地转发，在服务端看来就好像真的是一个普通客户端在访问，而记录的IP是代理服务器的IP；
- 普通匿名代理：会在数据包上做一些改动，服务端上有可能发现这是个代理服务器，也有一定几率追查到客户端的真实IP。代理服务器通常会加入的HTTP头有HTTP_VIA和HTTP_X_FORWARDED_FOR。
- 透明代理：不但改动了数据包，还会告诉服务器客户端的真实IP。这种代理除了能用缓存技
术提高浏览速度，能用内容过滤提高安全性之外，并无其他显著作用，最常见的例子是内网 中的硬件防火墙；
- 间谍代理：指组织或个人创建的用于记录用户传输的数据，然后进行研究、监控等目的的代理服务器。

我们常见的一些代理设置如下：

- 使用网上的免费代理：最好使用高匿代理，另外可用的代理不多，需要在使用前筛选一下可用代理，也可以进一步维护一个代理池；
- 使用付费代理服务：互联网上存在许多代理商，可以付费使用，质量比免费代理好很多；
- ADSL拨号：拨一次号换一次IP，稳定性高，也是一种比较有效的解决方案。